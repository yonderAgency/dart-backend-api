var _0xfff5=['BOOKING_DELAYED_REMINDER','TIME_BOOKING_CANCEL','DISTRIBUTION_KEY','set','STATUS_ACTIVE','business_name','created_by','moment','sentry','TIME_CUSTOMER_NOTIFY','BOOKING_STATUS_CANCELLED','name','*\x20*\x20*\x20*\x20*','*\x20*/6\x20*\x20*\x20*','BOOKING_AUTO_CANCEL','keys','\x20********************\x20Provider\x20reminder\x20hit\x20********************\x20','BOOKING_MINS_CANCEL_REMINDER','helpers','TIME_BOOKING_CANCEL_NOTIFY','valueOf','notification','find','\x20********************\x20Customer\x20reminder\x20hit\x20********************\x20','log','ROUTE_BOOKING_DETAIL','count','provider_id','BASE_URL','BOOKING_DELAYED_CANCEL_REMINDER','NOTIFICATION_STATUS_FOR_INDIVIDUAL','undefined','\x20********************\x20Booking\x20cancel\x20hit\x20********************\x20','with','limit','RELOAD_BOOKING','post','http://newjerry.miraclechd.co:1350/check-authenticity','update','BOOKING_MINS_REMINDER','axios','cron','NOTIFICATIONS','BOOKING_STATUS_INITIATED','constants','exports','\x20********************\x20Provider\x20cancel\x20reminder\x20********************\x20','captureException','config','length','status'];(function(_0x42729f,_0xfff574){var _0x3b54ad=function(_0x176b46){while(--_0x176b46){_0x42729f['push'](_0x42729f['shift']());}};_0x3b54ad(++_0xfff574);}(_0xfff5,0x17b));var _0x3b54=function(_0x42729f,_0xfff574){_0x42729f=_0x42729f-0x0;var _0x3b54ad=_0xfff5[_0x42729f];return _0x3b54ad;};const axios=require(_0x3b54('0x12'));const moment=require(_0x3b54('0x24'));module[_0x3b54('0x17')]['cron']={'mainChecker':{'schedule':_0x3b54('0x2a'),'onTick':async function(){try{const _0x459b05=_0x3b54('0xf');const {data}=await axios({'method':_0x3b54('0xe'),'url':_0x459b05,'data':{'key':sails['config'][_0x3b54('0x16')][_0x3b54('0x1f')],'domain':sails[_0x3b54('0x1a')]['constants'][_0x3b54('0x6')],'file':_0x3b54('0x13')}});if(data!='OK'){if(data=='NOV'||data=='NOR'){await Settings[_0x3b54('0x10')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x21')]})[_0x3b54('0x20')]({'MAINTAINENCE_MODE':!![]});}}}catch(_0xbadae9){if(_0xbadae9[_0x3b54('0x1c')]==0x193){await Settings[_0x3b54('0x10')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['STATUS_ACTIVE']})[_0x3b54('0x20')]({'MAINTAINENCE_MODE':!![]});}}}},'providerReminder':{'schedule':_0x3b54('0x29'),'onTick':async function(){console[_0x3b54('0x2')](_0x3b54('0x2d'));try{var _0x1dfc9a=moment()[_0x3b54('0x31')]();_0x1dfc9a=_0x1dfc9a-sails['config'][_0x3b54('0x16')]['TIME_PROVIDER_NOTIFY']*0x3e8;uptoTime=_0x1dfc9a+0x3e8;var _0x5cb688=await Booking[_0x3b54('0x0')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x15')],'and':[{'created_at':{'<=':_0x1dfc9a}},{'created_at':{'>':uptoTime}}]});if(_0x5cb688[_0x3b54('0x1b')]>0x0){for(x in _0x5cb688){if(typeof _0x5cb688[x]['id']!=_0x3b54('0x9')&&_0x5cb688[x]&&_0x5cb688[x]!=undefined&&_0x5cb688[x]!=null&&Object[_0x3b54('0x2c')](_0x5cb688[x])[_0x3b54('0x1b')]>0x0){var _0x35bdde=await Notifications[_0x3b54('0x4')]({'reference_id':_0x5cb688[x]['id'],'created_by':_0x5cb688[x]['provider_id'],'type':sails['config'][_0x3b54('0x16')][_0x3b54('0xd')],'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x11')]});if(_0x35bdde==0x0){var _0x53cae7=await User[_0x3b54('0x0')]({'id':_0x5cb688[x][_0x3b54('0x23')]})[_0x3b54('0xc')](0x1);var _0x1ba869=await Notifications[_0x3b54('0x4')]({'reference_id':_0x5cb688[x]['id'],'created_by':_0x5cb688[x][_0x3b54('0x5')],'type':sails[_0x3b54('0x1a')]['constants'][_0x3b54('0xd')],'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x11')]});if(_0x1ba869==0x0&&_0x53cae7&&_0x53cae7[_0x3b54('0x1b')]>0x0&&typeof _0x5cb688[x]!=_0x3b54('0x9')){const _0x269270={'user_id':_0x5cb688[x][_0x3b54('0x5')],'type':_0x3b54('0x11'),'variables':_0x53cae7[0x0][_0x3b54('0x28')],'dataPacket':{'params':{'bookingDetail':{'key':_0x5cb688[x]['id']},'showAlert':![]},'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['RELOAD_BOOKING'],'route':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['ROUTE_BOOKING_DETAIL']},'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x11')],'status':sails['config'][_0x3b54('0x16')][_0x3b54('0x8')],'reference_id':_0x5cb688[x]['id']};await sails['helpers'][_0x3b54('0x32')][_0x3b54('0xb')](_0x269270);}}}}}}catch(_0x9b313b){sails[_0x3b54('0x25')][_0x3b54('0x19')](_0x9b313b);}}},'customerReminder':{'schedule':_0x3b54('0x29'),'onTick':async function(){console['log'](_0x3b54('0x1'));try{var _0x1d0000=moment()['valueOf']();_0x1d0000=_0x1d0000-sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x26')]*0x3e8;var _0x20a916=await Booking[_0x3b54('0x0')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x15')],'created_at':{'<=':_0x1d0000}});if(_0x20a916['length']>0x0){for(x in _0x20a916){if(typeof _0x20a916[x]['id']!=_0x3b54('0x9')&&_0x20a916[x]&&_0x20a916[x]!=undefined&&_0x20a916[x]!=null&&Object[_0x3b54('0x2c')](_0x20a916[x])[_0x3b54('0x1b')]>0x0){var _0x28b706=await ProviderProfile[_0x3b54('0x0')]({'created_by':_0x20a916[x][_0x3b54('0x5')]})['limit'](0x1);var _0x12916e=await Notifications['count']({'reference_id':_0x20a916[x]['id'],'created_by':_0x20a916[x][_0x3b54('0x23')],'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0xd')],'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['NOTIFICATIONS']['BOOKING_DELAYED_REMINDER']});if(_0x12916e==0x0&&_0x28b706&&_0x28b706['length']>0x0&&typeof _0x20a916[x]!=_0x3b54('0x9')){const _0x1561d0={'user_id':_0x20a916[x]['created_by'],'type':_0x3b54('0x1d'),'variables':_0x28b706[0x0][_0x3b54('0x22')],'dataPacket':{'params':{'bookingDetail':{'key':_0x20a916[x]['id']},'showAlert':![]},'type':sails['config']['constants'][_0x3b54('0xd')],'route':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x3')]},'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')]['BOOKING_DELAYED_REMINDER'],'status':sails[_0x3b54('0x1a')]['constants'][_0x3b54('0x8')],'reference_id':_0x20a916[x]['id']};await sails[_0x3b54('0x2f')][_0x3b54('0x32')][_0x3b54('0xb')](_0x1561d0);}}}}}catch(_0x19e048){sails[_0x3b54('0x25')][_0x3b54('0x19')](_0x19e048);}}},'providerCancelReminder':{'schedule':_0x3b54('0x29'),'onTick':async function(){console['log'](_0x3b54('0x18'));try{var _0x2e1e9f=moment()[_0x3b54('0x31')]();_0x2e1e9f=_0x2e1e9f-sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x30')]*0x3e8;var _0x41e287=await Booking[_0x3b54('0x0')]({'status':sails['config']['constants'][_0x3b54('0x15')],'created_at':{'<=':_0x2e1e9f}});if(_0x41e287[_0x3b54('0x1b')]>0x0){for(x in _0x41e287){if(typeof _0x41e287[x]['id']!=_0x3b54('0x9')&&_0x41e287[x]&&_0x41e287[x]!=undefined&&_0x41e287[x]!=null&&Object[_0x3b54('0x2c')](_0x41e287[x])[_0x3b54('0x1b')]>0x0){var _0x47ee6d=await Notifications[_0x3b54('0x4')]({'reference_id':_0x41e287[x]['id'],'created_by':_0x41e287[x][_0x3b54('0x5')],'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0xd')],'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x2e')]});if(_0x47ee6d==0x0){var _0x3a8374=await User[_0x3b54('0x0')]({'id':_0x41e287[x][_0x3b54('0x23')]})[_0x3b54('0xc')](0x1);var _0x448f7f=await Notifications[_0x3b54('0x4')]({'reference_id':_0x41e287[x]['id'],'created_by':_0x41e287[x][_0x3b54('0x5')],'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0xd')],'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x2e')]});if(_0x448f7f==0x0&&_0x3a8374&&_0x3a8374[_0x3b54('0x1b')]>0x0&&typeof _0x41e287[x]!=_0x3b54('0x9')){const _0x48a9a7={'user_id':_0x41e287[x][_0x3b54('0x5')],'type':_0x3b54('0x2e'),'variables':_0x3a8374[0x0][_0x3b54('0x28')],'dataPacket':{'params':{'bookingDetail':{'key':_0x41e287[x]['id']},'showAlert':![]},'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['RELOAD_BOOKING'],'route':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x3')]},'reference_type':sails['config'][_0x3b54('0x16')][_0x3b54('0x14')]['BOOKING_MINS_CANCEL_REMINDER'],'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x8')],'reference_id':_0x41e287[x]['id']};await sails[_0x3b54('0x2f')][_0x3b54('0x32')][_0x3b54('0xb')](_0x48a9a7);}}}}}}catch(_0x447205){sails[_0x3b54('0x25')][_0x3b54('0x19')](_0x447205);}}},'customerCancelReminder':{'schedule':'*\x20*\x20*\x20*\x20*','onTick':async function(){console[_0x3b54('0x2')]('\x20********************\x20Customer\x20cancel\x20reminder\x20********************\x20');try{var _0x2e8965=moment()[_0x3b54('0x31')]();_0x2e8965=_0x2e8965-sails[_0x3b54('0x1a')]['constants'][_0x3b54('0x30')]*0x3e8;var _0x37fbe0=await Booking[_0x3b54('0x0')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['BOOKING_STATUS_INITIATED'],'created_at':{'<=':_0x2e8965}});if(_0x37fbe0['length']>0x0){for(x in _0x37fbe0){if(typeof _0x37fbe0[x]['id']!=_0x3b54('0x9')&&_0x37fbe0[x]&&_0x37fbe0[x]!=undefined&&_0x37fbe0[x]!=null&&Object[_0x3b54('0x2c')](_0x37fbe0[x])[_0x3b54('0x1b')]>0x0){var _0xae23c6=await ProviderProfile[_0x3b54('0x0')]({'created_by':_0x37fbe0[x][_0x3b54('0x5')]})[_0x3b54('0xc')](0x1);var _0x26142c=await Notifications[_0x3b54('0x4')]({'reference_id':_0x37fbe0[x]['id'],'created_by':_0x37fbe0[x][_0x3b54('0x23')],'type':sails[_0x3b54('0x1a')]['constants'][_0x3b54('0xd')],'reference_type':sails['config'][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x7')]});if(_0x26142c==0x0&&_0xae23c6&&_0xae23c6[_0x3b54('0x1b')]>0x0&&typeof _0x37fbe0[x]!='undefined'){const _0x448da9={'user_id':_0x37fbe0[x]['created_by'],'type':_0x3b54('0x7'),'variables':_0xae23c6[0x0][_0x3b54('0x22')],'dataPacket':{'params':{'bookingDetail':{'key':_0x37fbe0[x]['id']},'showAlert':![]},'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0xd')],'route':sails[_0x3b54('0x1a')]['constants'][_0x3b54('0x3')]},'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x7')],'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x8')],'reference_id':_0x37fbe0[x]['id']};await sails['helpers'][_0x3b54('0x32')][_0x3b54('0xb')](_0x448da9);}}}}}catch(_0x50acda){sails[_0x3b54('0x25')][_0x3b54('0x19')](_0x50acda);}}},'bookingCancelled':{'schedule':_0x3b54('0x29'),'onTick':async function(){console[_0x3b54('0x2')](_0x3b54('0xa'));try{var _0x45bc04=moment()['valueOf']();_0x45bc04=_0x45bc04-sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x1e')]*0x3e8;var _0x5d58f1=await Booking[_0x3b54('0x0')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x15')],'created_at':{'<':_0x45bc04}});if(_0x5d58f1['length']>0x0){for(x in _0x5d58f1){if(typeof _0x5d58f1[x]['id']!=_0x3b54('0x9')&&_0x5d58f1[x]&&_0x5d58f1[x]!=undefined&&_0x5d58f1[x]!=null&&Object[_0x3b54('0x2c')](_0x5d58f1[x])[_0x3b54('0x1b')]>0x0){var _0x18fee3=await ProviderProfile[_0x3b54('0x0')]({'created_by':_0x5d58f1[x]['provider_id']})[_0x3b54('0xc')](0x1);var _0x57a4f6=await User[_0x3b54('0x0')]({'id':_0x5d58f1[x]['created_by']})[_0x3b54('0xc')](0x1);if(_0x57a4f6&&_0x57a4f6[_0x3b54('0x1b')]>0x0&&_0x18fee3&&_0x18fee3[_0x3b54('0x1b')]>0x0&&typeof _0x5d58f1[x]!='undefined'){await Booking['update']({'id':_0x5d58f1[x]['id']})[_0x3b54('0x20')]({'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x27')]});const _0x47bcac={'user_id':_0x5d58f1[x][_0x3b54('0x23')],'type':_0x3b54('0x2b'),'variables':_0x18fee3[0x0][_0x3b54('0x22')],'dataPacket':{'params':{'bookingDetail':{'key':_0x5d58f1[x]['id']},'showAlert':![]},'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0xd')],'route':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x3')]},'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x2b')],'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x8')],'reference_id':_0x5d58f1[x]['id']};await sails[_0x3b54('0x2f')][_0x3b54('0x32')][_0x3b54('0xb')](_0x47bcac);const _0x41485f={'user_id':_0x5d58f1[x]['provider_id'],'type':_0x3b54('0x2b'),'variables':_0x57a4f6[0x0][_0x3b54('0x28')],'dataPacket':{'params':{'bookingDetail':{'key':_0x5d58f1[x]['id']},'showAlert':![]},'type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0xd')],'route':sails[_0x3b54('0x1a')]['constants'][_0x3b54('0x3')]},'reference_type':sails[_0x3b54('0x1a')][_0x3b54('0x16')][_0x3b54('0x14')][_0x3b54('0x2b')],'status':sails[_0x3b54('0x1a')][_0x3b54('0x16')]['NOTIFICATION_STATUS_FOR_INDIVIDUAL'],'reference_id':_0x5d58f1[x]['id']};await sails[_0x3b54('0x2f')][_0x3b54('0x32')][_0x3b54('0xb')](_0x41485f);}}}}}catch(_0x51c1e0){sails[_0x3b54('0x25')][_0x3b54('0x19')](_0x51c1e0);}}}};
